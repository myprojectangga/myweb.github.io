<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Upload Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  :root{
    --bg0:#070b14;
    --bg1:#0b1220;
    --bg2:#0f172a;

    --surface: rgba(15, 23, 42, .78);
    --surface2: rgba(2, 6, 23, .45);

    --text:#e5e7eb;
    --muted:#94a3b8;
    --muted2:#cbd5e1;

    --primary:#3b82f6;
    --primary2:#1d4ed8;

    --success:#10b981;
    --warning:#f59e0b;
    --danger:#ef4444;

    --border: rgba(255,255,255,.10);
    --border2: rgba(59,130,246,.25);

    --shadow: 0 20px 60px rgba(0,0,0,.45);
    --shadow2: 0 14px 30px rgba(0,0,0,.35);
    --ring: 0 0 0 3px rgba(59,130,246,.25);

    --r12: 12px;
    --r16: 16px;
    --r20: 20px;
  }

  *{
    margin:0;
    padding:0;
    box-sizing:border-box;
    max-width:100%;
  }

  html{
    color-scheme: dark;
    width:100%;
    max-width:100%;
    overflow-x:hidden;
  }

  body{
    position: relative;
    width:100%;
    max-width:100%;
    overflow-x:hidden;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    background:
      radial-gradient(1000px 600px at 18% 10%, rgba(59,130,246,.18), transparent 60%),
      radial-gradient(900px 550px at 82% 15%, rgba(16,185,129,.12), transparent 55%),
      radial-gradient(900px 700px at 50% 90%, rgba(139,92,246,.10), transparent 60%),
      linear-gradient(180deg, var(--bg0), var(--bg2));
    color: var(--text);
    min-height:100vh;
    padding: 22px;
  }

  /* Scrollbar */
  ::-webkit-scrollbar{ width:10px; height:10px; }
  ::-webkit-scrollbar-thumb{
    background: rgba(148,163,184,.25);
    border-radius: 999px;
    border: 2px solid rgba(2,6,23,.55);
  }
  ::-webkit-scrollbar-thumb:hover{ background: rgba(148,163,184,.35); }

  a{ color: var(--primary); }
  a:hover{ text-decoration: underline; }

  /* Safety for flex/grid overflow */
  .container,
  .section,
  .header,
  .tabs,
  .chart-container,
  .chart-area,
  .game-grid,
  .performance-stats,
  .performance-details{
    min-width:0;
  }

  canvas{ max-width:100% !important; }

  .container{
    max-width: 1400px;
    margin: 0 auto;
  }

  /* Header */
  .header{
    position: relative;
    border-radius: 22px;
    padding: 26px;
    margin-bottom: 26px;
    background:
      linear-gradient(135deg, rgba(99,102,241,.90), rgba(59,130,246,.70)),
      radial-gradient(900px 260px at 20% 0%, rgba(255,255,255,.18), transparent 60%);
    border: 1px solid rgba(255,255,255,.16);
    box-shadow: var(--shadow);
    display:flex;
    justify-content: space-between;
    align-items:center;
    overflow:hidden;
    gap: 14px;
    flex-wrap: wrap;
  }

  .header::after{
    content:"";
    position:absolute;
    inset:-1px;
    background: radial-gradient(600px 220px at 80% 0%, rgba(255,255,255,.22), transparent 60%);
    pointer-events:none;
    opacity:.55;
  }

  .header-content{ position:relative; z-index:1; }
  .header-content h1{
    font-size: clamp(1.8rem, 2.2vw, 2.6rem);
    letter-spacing: .2px;
    margin-bottom: 10px;
    color:#fff;
    text-shadow: 0 10px 30px rgba(0,0,0,.25);
  }

  .date-display{
    font-size: 1.05rem;
    color: rgba(255,255,255,.82);
  }

  .back-button{
    position:relative;
    z-index:1;
    padding: 12px 18px;
    background: rgba(2,6,23,.20);
    border: 1px solid rgba(255,255,255,.22);
    border-radius: 12px;
    color:#fff;
    text-decoration:none;
    font-weight: 800;
    display:inline-flex;
    align-items:center;
    gap:10px;
    transition: transform .18s ease, background .18s ease, border-color .18s ease, box-shadow .18s ease;
    backdrop-filter: blur(10px);
    white-space: nowrap;
  }
  .back-button:hover{
    transform: translateY(-2px);
    background: rgba(2,6,23,.30);
    border-color: rgba(255,255,255,.32);
    box-shadow: 0 12px 26px rgba(0,0,0,.25);
  }
  .back-button:focus-visible{
    outline:none;
    box-shadow: var(--ring), 0 12px 26px rgba(0,0,0,.25);
  }

  /* Tabs */
  .tabs{
    display:flex;
    gap:10px;
    margin-bottom: 22px;
    padding: 10px;
    border-radius: 16px;
    background: rgba(2,6,23,.35);
    border: 1px solid var(--border);
    backdrop-filter: blur(12px);
    box-shadow: 0 10px 24px rgba(0,0,0,.22);
    flex-wrap: wrap;
  }

  .tab{
    flex:1;
    padding: 14px 16px;
    border: 1px solid transparent;
    background: transparent;
    color: var(--muted);
    font-size: 1.05rem;
    font-weight: 900;
    border-radius: 12px;
    cursor:pointer;
    transition: background .18s ease, transform .18s ease, color .18s ease, border-color .18s ease, box-shadow .18s ease;
    text-align:center;
    user-select:none;
    min-width: 220px;
  }

  .tab:hover:not(.active){
    background: rgba(59,130,246,.10);
    border-color: rgba(59,130,246,.18);
    color: #dbeafe;
  }

  .tab.active{
    background: linear-gradient(135deg, rgba(59,130,246,.95), rgba(29,78,216,.90));
    color:#fff;
    box-shadow: 0 14px 26px rgba(59,130,246,.20);
    border-color: rgba(255,255,255,.14);
    transform: translateY(-1px);
  }

  .tab:focus-visible{
    outline:none;
    box-shadow: var(--ring);
  }

  /* Tab content */
  .tab-content{ display:none; }
  .tab-content.active{
    display:block;
    animation: fadeIn .35s ease;
  }
  @keyframes fadeIn{
    from{ opacity:0; transform: translateY(10px); }
    to{ opacity:1; transform: translateY(0); }
  }

  /* Section */
  .section{
    background: var(--surface);
    border-radius: 20px;
    padding: 24px;
    margin-bottom: 22px;
    border: 1px solid var(--border);
    box-shadow: var(--shadow2);
    backdrop-filter: blur(12px);
  }

  .section-title{
    color: #dbeafe;
    font-size: 1.35rem;
    margin-bottom: 20px;
    padding-bottom: 14px;
    border-bottom: 1px solid rgba(255,255,255,.10);
    display:flex;
    align-items:center;
    gap:10px;
    font-weight: 950;
    flex-wrap: wrap;
  }

  /* Target input section */
  .target-input-section{
    background:
      radial-gradient(700px 220px at 20% 0%, rgba(59,130,246,.20), transparent 60%),
      linear-gradient(135deg, rgba(2,6,23,.40), rgba(15,23,42,.75));
    border: 1px solid rgba(59,130,246,.18);
  }

  .target-input-group{
    display:flex;
    gap: 12px;
    align-items:center;
    flex-wrap: wrap;
  }

  .target-input{
    flex:1;
    min-width: 220px;
    padding: 14px 16px;
    background: rgba(2,6,23,.45);
    border: 1px solid rgba(255,255,255,.12);
    border-radius: 12px;
    color: #fff;
    font-size: 1.05rem;
    transition: box-shadow .18s ease, border-color .18s ease, background .18s ease;
  }
  .target-input::placeholder{ color: rgba(148,163,184,.85); }
  .target-input:focus{
    outline:none;
    border-color: rgba(59,130,246,.55);
    box-shadow: var(--ring);
    background: rgba(2,6,23,.55);
  }

  /* Progress */
  .progress-section{
    background:
      radial-gradient(700px 240px at 80% 0%, rgba(16,185,129,.12), transparent 60%),
      rgba(2,6,23,.30);
  }

  .progress-header{
    display:flex;
    justify-content: space-between;
    align-items:center;
    margin-bottom: 16px;
    gap: 16px;
    flex-wrap: wrap;
  }

  .progress-stats{
    display:flex;
    gap: 12px;
    flex-wrap: wrap;
  }

  .stat-item{
    text-align:center;
    padding: 10px 14px;
    border-radius: 14px;
    background: rgba(2,6,23,.28);
    border: 1px solid rgba(255,255,255,.08);
    min-width: 110px;
  }

  .stat-value{
    font-size: 1.9rem;
    font-weight: 1000;
    color: #dbeafe;
    margin-bottom: 4px;
  }

  .stat-label{
    color: var(--muted);
    font-size: .9rem;
    font-weight: 800;
  }

  .progress-container{
    background: rgba(148,163,184,.18);
    border-radius: 999px;
    height: 26px;
    overflow:hidden;
    margin: 18px 0 2px;
    border: 1px solid rgba(255,255,255,.08);
  }

  .progress-bar{
    height: 100%;
    background: linear-gradient(90deg, rgba(16,185,129,.95), rgba(59,130,246,.85));
    border-radius: 999px;
    transition: width .45s ease;
    position: relative;
    display:flex;
    align-items:center;
    justify-content: flex-end;
    padding-right: 10px;
  }

  .progress-text{
    color:#fff;
    font-weight: 950;
    font-size: .9rem;
    text-shadow: 0 6px 18px rgba(0,0,0,.35);
  }

  /* Game list cards */
  .game-grid{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 16px;
    margin-bottom: 10px;
  }

  .game-card{
    background: rgba(2,6,23,.30);
    border-radius: 16px;
    padding: 18px;
    border: 1px solid rgba(255,255,255,.10);
    border-left: 5px solid rgba(148,163,184,.45);
    transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease, background .18s ease;
    overflow: hidden;
  }

  .game-card:hover{
    transform: translateY(-4px);
    box-shadow: 0 18px 34px rgba(0,0,0,.35);
    border-color: rgba(59,130,246,.25);
    background: rgba(2,6,23,.36);
  }

  .game-card.completed{ border-left-color: rgba(16,185,129,.95); }
  .game-card.in-progress{ border-left-color: rgba(245,158,11,.95); }
  .game-card.pending{ border-left-color: rgba(148,163,184,.55); }

  .game-card.bonus{
    border-left-color: rgba(245,158,11,.95);
    background:
      radial-gradient(600px 240px at 30% 0%, rgba(245,158,11,.12), transparent 60%),
      rgba(2,6,23,.30);
  }

  .game-header{
    display:flex;
    justify-content: space-between;
    align-items:center;
    margin-bottom: 12px;
    gap: 10px;
    flex-wrap: wrap;
  }

  .game-number{
    font-size: 1.1rem;
    font-weight: 1000;
    color: #dbeafe;
    display:flex;
    align-items:center;
    gap: 8px;
    overflow:hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    max-width: 100%;
  }

  .game-status{
    padding: 6px 12px;
    border-radius: 999px;
    font-size: .82rem;
    font-weight: 950;
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(2,6,23,.25);
    white-space: nowrap;
  }

  .game-status.pending{ color: #e2e8f0; background: rgba(148,163,184,.12); }
  .game-status.in-progress{ color: #fbbf24; background: rgba(245,158,11,.14); }
  .game-status.completed{ color: #34d399; background: rgba(16,185,129,.14); }

  .game-details{ margin: 12px 0; }
  .detail-item{
    display:flex;
    justify-content: space-between;
    margin-bottom: 8px;
    color: var(--muted);
    gap: 12px;
  }

  .detail-item strong{
    color: var(--muted2);
    font-weight: 900;
    text-align: right;
    max-width: 60%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .detail-item a{
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: inline-block;
    max-width: 100%;
  }

  .game-actions{
    display:flex;
    gap: 10px;
    margin-top: 14px;
    flex-wrap: wrap;
  }

  /* Buttons */
  .btn{
    padding: 12px 16px;
    border: 1px solid rgba(255,255,255,.10);
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 950;
    cursor:pointer;
    transition: transform .18s ease, box-shadow .18s ease, filter .18s ease, background .18s ease, border-color .18s ease;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap: 8px;
    background: rgba(2,6,23,.25);
    color: #fff;
    white-space: nowrap;
  }
  .btn:hover{ transform: translateY(-2px); }
  .btn:focus-visible{ outline:none; box-shadow: var(--ring); }
  .btn:disabled{
    opacity: .55;
    cursor: not-allowed;
    transform:none !important;
    box-shadow:none !important;
    filter:none !important;
  }

  .btn-primary{
    background: linear-gradient(135deg, rgba(59,130,246,.95), rgba(29,78,216,.90));
    border-color: rgba(59,130,246,.35);
  }
  .btn-primary:hover{ box-shadow: 0 14px 28px rgba(59,130,246,.18); }

  .btn-success{
    background: linear-gradient(135deg, rgba(16,185,129,.95), rgba(5,150,105,.90));
    border-color: rgba(16,185,129,.35);
  }
  .btn-success:hover{ box-shadow: 0 14px 28px rgba(16,185,129,.18); }

  .btn-warning{
    background: linear-gradient(135deg, rgba(245,158,11,.95), rgba(217,119,6,.90));
    border-color: rgba(245,158,11,.35);
  }
  .btn-warning:hover{ box-shadow: 0 14px 28px rgba(245,158,11,.18); }

  .btn-danger{
    background: linear-gradient(135deg, rgba(239,68,68,.95), rgba(220,38,38,.90));
    border-color: rgba(239,68,68,.35);
  }
  .btn-danger:hover{ box-shadow: 0 14px 28px rgba(239,68,68,.18); }

  /* Bonus section */
  .bonus-section{
    background:
      radial-gradient(800px 240px at 20% 0%, rgba(245,158,11,.12), transparent 60%),
      rgba(2,6,23,.25);
    padding: 22px;
    border-radius: 16px;
    margin-top: 22px;
    border: 1px dashed rgba(245,158,11,.55);
    box-shadow: 0 14px 30px rgba(0,0,0,.22);
  }

  .bonus-title{
    color: #fde68a;
    margin-bottom: 12px;
    display:flex;
    align-items:center;
    gap: 10px;
    font-weight: 1000;
    flex-wrap: wrap;
  }

  /* Charts */
  .chart-container{
    background: rgba(2,6,23,.28);
    border-radius: 16px;
    padding: 18px;
    border: 1px solid rgba(255,255,255,.10);
    box-shadow: 0 14px 28px rgba(0,0,0,.26);
    overflow: hidden;
  }

  .chart-grid{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 18px;
  }

  .chart-container h3{
    font-size: 1.05rem;
    margin-bottom: 12px;
    color: #e2e8f0;
    font-weight: 950;
    overflow:hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .chart-area{
    position: relative;
    height: 310px;
    border-radius: 14px;
    overflow:hidden;
    background: rgba(15,23,42,.25);
    border: 1px solid rgba(255,255,255,.06);
  }
  .chart-area canvas{
    width: 100% !important;
    height: 100% !important;
    display:block;
  }

  .chart-header{
    display:flex;
    justify-content: space-between;
    align-items:center;
    margin-bottom: 16px;
    gap: 14px;
    flex-wrap: wrap;
  }

  .chart-header h3{
    color: var(--muted2);
    font-weight: 950;
  }

  .time-filter{
    display:flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .filter-btn{
    padding: 9px 14px;
    background: rgba(59,130,246,.10);
    border: 1px solid rgba(59,130,246,.22);
    border-radius: 12px;
    color: #bfdbfe;
    cursor:pointer;
    transition: transform .18s ease, background .18s ease, border-color .18s ease, box-shadow .18s ease;
    font-weight: 950;
    white-space: nowrap;
  }
  .filter-btn:hover{ transform: translateY(-1px); }
  .filter-btn.active{
    background: linear-gradient(135deg, rgba(59,130,246,.95), rgba(29,78,216,.90));
    border-color: rgba(59,130,246,.35);
    color:#fff;
    box-shadow: 0 14px 26px rgba(59,130,246,.16);
  }
  .filter-btn:focus-visible{ outline:none; box-shadow: var(--ring); }

  /* Performance */
  .performance-stats{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 16px;
    margin-bottom: 20px;
  }

  .stat-card{
    background: rgba(2,6,23,.28);
    padding: 18px;
    border-radius: 16px;
    text-align:center;
    border: 1px solid rgba(255,255,255,.10);
    transition: transform .18s ease, border-color .18s ease, box-shadow .18s ease;
    box-shadow: 0 14px 28px rgba(0,0,0,.24);
    overflow: hidden;
  }
  .stat-card:hover{
    transform: translateY(-4px);
    border-color: rgba(59,130,246,.25);
    box-shadow: 0 18px 34px rgba(0,0,0,.30);
  }

  .stat-card-icon{ font-size: 2.2rem; margin-bottom: 10px; }
  .stat-card-value{
    font-size: 2.2rem;
    font-weight: 1000;
    color: #dbeafe;
    margin-bottom: 8px;
  }
  .stat-card-label{
    color: var(--muted);
    font-size: 1rem;
    font-weight: 850;
  }

  .performance-details{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 16px;
  }

  .platform-breakdown,
  .achievement-section{
    background: rgba(2,6,23,.28);
    padding: 18px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,.10);
    box-shadow: 0 14px 28px rgba(0,0,0,.24);
    overflow: hidden;
  }

  .platform-breakdown h3,
  .achievement-section h3{
    font-weight: 1000;
    margin-bottom: 8px;
    color: #e2e8f0;
    overflow:hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .platform-list{ margin-top: 10px; }

  .platform-item{
    display:flex;
    justify-content: space-between;
    align-items:center;
    padding: 12px 0;
    border-bottom: 1px solid rgba(255,255,255,.08);
    gap: 12px;
  }
  .platform-item:last-child{ border-bottom:none; }

  .platform-info{
    display:flex;
    align-items:center;
    gap:10px;
    min-width: 0;
  }
  .platform-icon{
    width: 24px;
    height: 24px;
    display:flex;
    align-items:center;
    justify-content:center;
    flex: 0 0 auto;
  }
  .platform-name{
    font-weight: 950;
    color: var(--muted2);
    overflow:hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .platform-count{
    font-weight: 1000;
    color: #dbeafe;
    white-space: nowrap;
    flex: 0 0 auto;
  }

  .achievement-item{
    padding: 14px;
    margin: 10px 0;
    border-radius: 14px;
    background: rgba(59,130,246,.10);
    border: 1px solid rgba(59,130,246,.18);
    border-left: 4px solid rgba(59,130,246,.55);
    color: #e5e7eb;
    overflow: hidden;
  }
  .achievement-item.success{ border-left-color: rgba(16,185,129,.95); }
  .achievement-item.warning{ border-left-color: rgba(245,158,11,.95); }
  .achievement-item.danger{ border-left-color: rgba(239,68,68,.95); }

  /* Modal */
  .modal{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background: rgba(0,0,0,.70);
    z-index:1000;
    align-items:center;
    justify-content:center;
    backdrop-filter: blur(8px);
    padding: 16px;
    overflow-x:hidden;
  }

  .modal-content{
    background:
      radial-gradient(900px 340px at 20% 0%, rgba(59,130,246,.14), transparent 60%),
      linear-gradient(135deg, rgba(15,23,42,.95), rgba(2,6,23,.86));
    padding: 24px;
    border-radius: 20px;
    max-width: 520px;
    width: 100%;
    max-height: 90vh;
    overflow-y:auto;
    border: 1px solid rgba(255,255,255,.12);
    box-shadow: var(--shadow);
    animation: popIn .20s ease;
  }
  @keyframes popIn{
    from{ transform: translateY(6px) scale(.98); opacity:0; }
    to{ transform: translateY(0) scale(1); opacity:1; }
  }

  .modal-header{ margin-bottom: 18px; }

  .modal-title{
    font-size: 1.35rem;
    color: #dbeafe;
    display:flex;
    align-items:center;
    gap: 10px;
    font-weight: 1000;
    flex-wrap: wrap;
  }

  .form-group{ margin-bottom: 16px; }
  .form-group label{
    display:block;
    margin-bottom: 8px;
    font-weight: 950;
    color: var(--muted2);
  }

  .form-group input,
  .form-group select{
    width: 100%;
    padding: 12px 14px;
    background: rgba(2,6,23,.38);
    border: 1px solid rgba(255,255,255,.12);
    border-radius: 12px;
    color: #fff;
    font-size: 1rem;
    transition: box-shadow .18s ease, border-color .18s ease, background .18s ease;
  }
  .form-group input::placeholder{ color: rgba(148,163,184,.85); }
  .form-group input:focus,
  .form-group select:focus{
    outline:none;
    border-color: rgba(59,130,246,.55);
    box-shadow: var(--ring);
    background: rgba(2,6,23,.48);
  }

  .modal-actions{
    display:flex;
    gap: 12px;
    margin-top: 18px;
    flex-wrap: wrap;
  }

  /* Timer */
  .timer-display{
    font-size: 3.2rem;
    font-weight: 1100;
    text-align:center;
    color: #dbeafe;
    margin: 22px 0;
    text-shadow: 0 0 24px rgba(59,130,246,.25);
  }

  /* Loading */
  .loading{
    display:inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(59,130,246,.25);
    border-top: 3px solid rgba(59,130,246,.95);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  @keyframes spin{
    0%{ transform: rotate(0); }
    100%{ transform: rotate(360deg); }
  }

  /* Chart.js helper (kalau kamu pakai class ini) */
  .chart-canvas{ display:block; }

  /* Responsive */
  @media (max-width: 1024px){
    body{ padding: 16px; }
    .container{ max-width: 100%; }
  }

  @media (max-width: 768px){
    body{ padding: 14px; }

    .header{
      flex-direction: column;
      gap: 14px;
      text-align:center;
      align-items: center;
    }

    .tabs{ flex-direction: column; }
    .tab{ min-width: 0; width: 100%; }

    .game-grid{ grid-template-columns: 1fr; }
    .chart-grid{ grid-template-columns: 1fr; }
    .performance-stats{ grid-template-columns: 1fr; }
    .performance-details{ grid-template-columns: 1fr; }

    .target-input-group{ flex-direction: column; }
    .target-input{ width: 100%; min-width: 0; }

    .chart-area{ height: 260px; }

    .modal{ padding: 12px; }
    .modal-content{ width: 100%; }
  }

  @media (max-width: 480px){
    body{ padding: 12px; }
    .section{ padding: 16px; }

    .detail-item strong{ max-width: 62%; }

    .timer-display{ font-size: 2.3rem; }
  }

  @media (prefers-reduced-motion: reduce){
    *{ animation:none !important; transition:none !important; }
  }
</style>

</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>üéÆ Target Kerja Harian</h1>
                <div class="date-display" id="currentDate"></div>
            </div>
            <a href="keuangan" class="back-button">‚Üê Kembali ke Beranda</a>
        </header>

        <!-- Navigation Tabs -->
        <nav class="tabs">
          <button class="tab active" onclick="switchTab('target', this)">üéØ Tugas Target</button>
          <button class="tab" onclick="switchTab('charts', this)">üìä Grafik</button>
          <button class="tab" onclick="switchTab('performance', this)">‚≠ê Kinerja Kerja</button>
        </nav>


        <!-- TARGET TAB -->
        <div id="targetTab" class="tab-content active">
            <!-- Target Input Section -->
            <div class="section target-input-section">
                <h2 class="section-title">üéØ Set Target Harian</h2>
                <div class="target-input-group">
                    <input type="number" id="targetInput" class="target-input" 
                           placeholder="Masukkan jumlah game target hari ini" min="1" max="20">
                    <button class="btn btn-primary" onclick="setDailyTarget()" id="setTargetBtn">
                        <span>üöÄ Set Target</span>
                    </button>
                </div>
            </div>

            <!-- Progress Section -->
            <div class="section progress-section" id="progressSection" style="display: none;">
                <div class="progress-header">
                    <h2 class="section-title">üìä Progress Harian</h2>
                    <div class="progress-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="completedCount">0</div>
                            <div class="stat-label">Selesai</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalTarget">0</div>
                            <div class="stat-label">Target</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalTime">0</div>
                            <div class="stat-label">Menit</div>
                        </div>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar" style="width: 0%;">
                        <span class="progress-text" id="progressText">0%</span>
                    </div>
                </div>
            </div>

            <!-- Game List -->
            <div class="section">
                <h2 class="section-title">üéÆ Daftar Game Hari Ini</h2>
                <div class="game-grid" id="gameList">
                    <!-- Game cards will be loaded here -->
                </div>
            </div>

            <!-- Bonus Section -->
            <div class="bonus-section">
                <h3 class="bonus-title">‚≠ê Bonus Game (Optional)</h3>
                <p style="color: #fbbf24; margin-bottom: 20px;">Setelah menyelesaikan semua target, Anda bisa menambah game bonus jika ingin melanjutkan kerja.</p>
                <button class="btn btn-warning" onclick="addBonusGame()" id="addBonusBtn" disabled>
                    <span>‚ûï Tambah Game Bonus</span>
                </button>
            </div>
        </div>

        <!-- CHARTS TAB -->
        <div id="chartsTab" class="tab-content">
            <div class="section">
                <h2 class="section-title">üìà Grafik Kinerja</h2>
                
                <!-- Time Filter -->
                <div class="chart-header">
                    <h3>Performa berdasarkan Periode</h3>
                <div class="time-filter">
                  <button class="filter-btn active" data-period="day" onclick="loadCharts('day')">Hari Ini</button>
                  <button class="filter-btn" data-period="week" onclick="loadCharts('week')">Minggu Ini</button>
                  <button class="filter-btn" data-period="month" onclick="loadCharts('month')">Bulan Ini</button>
                </div>

                </div>

                <!-- Charts Grid -->
                <div class="chart-grid">
                    <!-- Pie Chart -->
                    <div class="chart-container">
                      <h3>üìä Distribusi Platform</h3>
                      <div class="chart-area">
                        <canvas id="platformPieChart"></canvas>
                      </div>
                    </div>
                    <!-- Line Chart -->
                    <div class="chart-container">
                      <h3>üìà Trend Penyelesaian</h3>
                      <div class="chart-area">
                        <canvas id="completionLineChart"></canvas>
                      </div>
                    </div>

                    <!-- Bar Chart -->
                    <div class="chart-container">
                      <h3>üìä Distribusi Platform</h3>
                      <div class="chart-area">
                        <canvas id="platformBarChart"></canvas>
                      </div>
                    </div>

                    <!-- Time Chart -->
                    <div class="chart-container">
                      <h3>‚è±Ô∏è Waktu Pengerjaan</h3>
                      <div class="chart-area">
                        <canvas id="timeChart"></canvas>
                      </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PERFORMANCE TAB -->
        <div id="performanceTab" class="tab-content">
            <div class="section">
                <h2 class="section-title">‚≠ê Statistik Kinerja</h2>
                
                <!-- Performance Stats -->
                <div class="performance-stats">
                    <div class="stat-card">
                        <div class="stat-card-icon">üéÆ</div>
                        <div class="stat-card-value" id="dailyTotal">0</div>
                        <div class="stat-card-label">Total Game Hari Ini</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon">üìÖ</div>
                        <div class="stat-card-value" id="weeklyTotal">0</div>
                        <div class="stat-card-label">Total Game Minggu Ini</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon">üìä</div>
                        <div class="stat-card-value" id="monthlyTotal">0</div>
                        <div class="stat-card-label">Total Game Bulan Ini</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon">‚è±Ô∏è</div>
                        <div class="stat-card-value" id="avgTime">0</div>
                        <div class="stat-card-label">Rata-rata Waktu/Game</div>
                    </div>
                </div>

                <!-- Performance Details -->
                <div class="performance-details">
                    <!-- Platform Breakdown -->
                    <div class="platform-breakdown">
                        <h3>üéÆ Breakdown per Platform</h3>
                        <div class="platform-list" id="platformList">
                            <!-- Platform items will be loaded here -->
                        </div>
                    </div>

                    <!-- Achievement Summary -->
                    <div class="achievement-section">
                        <h3>üèÜ Ringkasan Pencapaian</h3>
                        <div id="achievementSummary">
                            <!-- Achievement items will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Yesterday Performance -->
                <div class="section" style="margin-top: 30px;">
                    <h2 class="section-title">üìÖ Performa Kemarin</h2>
                    <div id="yesterdayPerformance">
                        <!-- Yesterday performance will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Complete Game Modal -->
    <div class="modal" id="completeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚úÖ Selesaikan Game</h2>
            </div>
            <form id="completeForm">
                <input type="hidden" id="completeGameId">
                
                <div class="form-group">
                    <label for="gameName">Nama Game</label>
                    <input type="text" id="gameName" placeholder="Masukkan nama game" required>
                </div>
                
                <div class="form-group">
                    <label for="gameLink">Link Game</label>
                    <input type="url" id="gameLink" placeholder="https://example.com/game-link" required>
                </div>
                
                <div class="form-group">
                    <label for="platform">Platform</label>
                    <select id="platform" required>
                        <option value="">Pilih platform</option>
                        <option value="Switch">Switch</option>
                        <option value="PS Vita">PS Vita</option>
                        <option value="PSP">PSP</option>
                        <option value="PS2">PS2</option>
                        <option value="Android">Android</option>
                        <option value="PC">PC</option>
                        <option value="Lainnya">Lainnya</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Durasi: <span id="durationDisplay">0 menit</span></label>
                    <input type="hidden" id="durationMinutes">
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-danger" onclick="closeCompleteModal()">Batal</button>
                    <button type="submit" class="btn btn-success">Simpan & Selesai</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Game Timer Modal -->
    <div class="modal" id="timerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚è±Ô∏è Timer Berjalan</h2>
            </div>
            <div style="text-align: center;">
                <div class="timer-display" id="timerDisplay">
                    00:00:00
                </div>
                <p style="color: #94a3b8; margin-bottom: 30px;">Game sedang dikerjakan...</p>
                <button class="btn btn-success" onclick="showCompleteModal()" style="padding: 15px 40px; font-size: 1.2rem;">
                    ‚úÖ Selesaikan Game
                </button>
                <button class="btn btn-danger" onclick="closeTimerModal()" style="padding: 12px 28px; margin-top: 12px;">
                  ‚ùå Tutup Timer
                </button>

            </div>
        </div>
    </div>

    <script>
        // Configuration
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx2mXXmhVQUlbm4Y6bPSe7Mg5FXOUiJj9hNss08qc_c1mp07PeJGZTQFgJ-VHCUA5yS2g/exec';
        
        // Global variables
        let currentTarget = 0;
        let completedGames = 0;
        let gameList = [];
        let startTime = null;
        let timerInterval = null;
        let currentGameId = null;
        let charts = {};
        let currentChartPeriod = 'day';

        // Initialize
document.addEventListener('DOMContentLoaded', function() {
  updateCurrentDate();
  loadData();

  setInterval(updateCurrentDate, 60000);
  setInterval(checkDateChange, 60000);

  setInterval(() => {
    const completeOpen = document.getElementById('completeModal')?.style.display === 'flex';
    const timerOpen = document.getElementById('timerModal')?.style.display === 'flex';
    if (completeOpen || timerOpen) return;

    loadData();
  }, 30000);
});

function closeTimerModal() {
  document.getElementById('timerModal').style.display = 'none';

  if (timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
  }
}

function updateCurrentDate() {
  const now = new Date();
  document.getElementById('currentDate').textContent = now.toLocaleString('id-ID', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
}


        function checkDateChange() {
            const now = new Date();
            const lastCheck = window.lastDateCheck || now;
            
            // Check if date has changed
            if (now.getDate() !== lastCheck.getDate() ||
                now.getMonth() !== lastCheck.getMonth() ||
                now.getFullYear() !== lastCheck.getFullYear()) {
                
                // Date changed, reset UI
                resetUIForNewDay();
            }
            
            window.lastDateCheck = now;
        }

function resetUIForNewDay() {
  // Reset state JS
  currentTarget = 0;
  completedGames = 0;
  gameList = [];
  currentGameId = null;
  startTime = null;

  if (timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
  }

  // Reset target input
  document.getElementById('targetInput').value = '';
  document.getElementById('setTargetBtn').disabled = false;
  document.getElementById('setTargetBtn').innerHTML = '<span>üöÄ Set Target</span>';

  // Hide progress section
  document.getElementById('progressSection').style.display = 'none';

  // Disable bonus button
  document.getElementById('addBonusBtn').disabled = true;
  document.getElementById('addBonusBtn').innerHTML = '<span>‚ûï Tambah Game Bonus</span>';

  // Clear game list UI
  document.getElementById('gameList').innerHTML = '';

  // Reload data
  loadData();

  // Notification
  showNotification('Hari baru telah dimulai! Silakan set target untuk hari ini.', 'info');
}


function showNotification(message, type = 'info') {
  const notification = document.createElement('div');

  const bg =
    type === 'success' ? '#10b981' :
    type === 'error' ? '#ef4444' :
    '#3b82f6';

  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 25px;
    background: ${bg};
    color: white;
    border-radius: 10px;
    z-index: 10000;
    animation: slideIn 0.3s ease;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  `;

  const row = document.createElement('div');
  row.style.cssText = 'display:flex; align-items:center; gap:10px;';

  const icon = document.createElement('span');
  icon.textContent = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';

  const text = document.createElement('span');
  text.textContent = String(message);

  row.appendChild(icon);
  row.appendChild(text);
  notification.appendChild(row);

  document.body.appendChild(notification);

  setTimeout(() => {
    notification.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => notification.remove(), 300);
  }, 5000);
}


async function loadData() {
  try {
    await loadTodayTarget();
    await loadGameList();
    await loadPerformanceStats();

    if (document.getElementById('chartsTab').classList.contains('active')) {
      await loadCharts(currentChartPeriod);
    }
  } catch (error) {
    console.error('Error loading data:', error);
    showNotification('Gagal memuat data: ' + error.message, 'error');
  }
}



async function loadTodayTarget() {
  try {
    const response = await fetch(`${SCRIPT_URL}?action=getTodayTarget`);
    const data = await response.json();

    if (data.status === 'success' && data.data) {
      currentTarget = data.data.target || 0;
      completedGames = data.data.completed || 0;

      if (currentTarget > 0) {
        document.getElementById('targetInput').value = currentTarget;
        document.getElementById('setTargetBtn').disabled = true;
        document.getElementById('setTargetBtn').innerHTML = '<span>‚úÖ Target Sudah Diset</span>';

        // Show progress
        document.getElementById('progressSection').style.display = 'block';
        document.getElementById('completedCount').textContent = completedGames;
        document.getElementById('totalTarget').textContent = currentTarget;
        document.getElementById('totalTime').textContent = data.data.totalTime || 0;

        // Clamp progress supaya tidak lewat 100%
        const progressRaw = (completedGames / currentTarget) * 100;
        const progress = Math.min(100, Math.max(0, progressRaw));

        document.getElementById('progressBar').style.width = `${progress}%`;
        document.getElementById('progressText').textContent = `${Math.round(progress)}%`;

        // Enable bonus jika target terpenuhi
        document.getElementById('addBonusBtn').disabled = completedGames < currentTarget;
      } else {
        // Reset UI jika hari baru belum ada target
        document.getElementById('targetInput').value = '';
        document.getElementById('setTargetBtn').disabled = false;
        document.getElementById('setTargetBtn').innerHTML = '<span>üöÄ Set Target</span>';
        document.getElementById('progressSection').style.display = 'none';
        document.getElementById('addBonusBtn').disabled = true;
      }
    }
  } catch (error) {
    console.error('Error loading target:', error);
  }
}


        async function loadGameList() {
            try {
                const response = await fetch(`${SCRIPT_URL}?action=getGameList`);
                const data = await response.json();
                
                if (data.status === 'success' && data.data) {
                    gameList = data.data;
                    renderGameList();
                }
            } catch (error) {
                console.error('Error loading game list:', error);
            }
        }

function renderGameList() {
  const gameListContainer = document.getElementById('gameList');
  gameListContainer.innerHTML = '';

  if (gameList.length === 0) {
    gameListContainer.innerHTML = `
      <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #94a3b8;">
        <div style="font-size: 3rem; margin-bottom: 20px;">üéÆ</div>
        <h3 style="margin-bottom: 10px;">Belum ada game hari ini</h3>
        <p>Set target terlebih dahulu untuk memulai</p>
      </div>
    `;
    return;
  }

  gameList.forEach(game => {
    const gameCard = document.createElement('div');
    gameCard.className = `game-card ${game.status.toLowerCase().replace(' ', '-')} ${game.isBonus ? 'bonus' : ''}`;

    let statusBadge = '';
    let actionButton = '';

    if (game.status === 'Pending') {
      statusBadge = '<span class="game-status pending">üïê Menunggu</span>';
      actionButton = game.canStart
        ? `<button class="btn btn-primary" onclick="startGame('${game.id}')">‚ñ∂Ô∏è Mulai</button>`
        : `<button class="btn btn-primary" disabled>‚è≥ Tunggu Sebelumnya</button>`;
    } else if (game.status === 'In Progress') {
      statusBadge = '<span class="game-status in-progress">‚è±Ô∏è Sedang Dikerjakan</span>';
      actionButton = `<button class="btn btn-warning" onclick="showTimerModal('${game.id}')">‚è±Ô∏è Lihat Timer</button>`;
    } else if (game.status === 'Completed') {
      statusBadge = '<span class="game-status completed">‚úÖ Selesai</span>';
      actionButton = `<button class="btn btn-success" disabled>‚úÖ Selesai</button>`;
    }

    const durationText = game.duration ? `${game.duration} menit` : '-';
    const platformText = game.platform || 'Belum diisi';
    const linkText = game.link
      ? `<a href="${game.link}" target="_blank" rel="noopener noreferrer" style="color: #3b82f6; text-decoration: none;">üîó Lihat</a>`
      : '<span style="color: #94a3b8;">-</span>';

    gameCard.innerHTML = `
      <div class="game-header">
        <div class="game-number">
          ${game.isBonus ? '‚≠ê ' : ''}Game ${game.gameNumber}
        </div>
        ${statusBadge}
      </div>
      <div class="game-details">
        <div class="detail-item">
          <span>üéÆ Platform:</span>
          <strong>${platformText}</strong>
        </div>
        <div class="detail-item">
          <span>‚è±Ô∏è Durasi:</span>
          <strong>${durationText}</strong>
        </div>
        <div class="detail-item">
          <span>üîó Link:</span>
          ${linkText}
        </div>
        ${game.gameName && game.gameName !== `Game ${game.gameNumber}` ? `
        <div class="detail-item">
          <span>üìù Nama:</span>
          <strong>${game.gameName}</strong>
        </div>
        ` : ''}
      </div>
      <div class="game-actions">
        ${actionButton}
      </div>
    `;

    gameListContainer.appendChild(gameCard);
  });
}


        // FIX 4: Add lock mechanism simulation
        let lock = false;

        async function withLock(fn) {
            if (lock) {
                throw new Error('Sedang memproses, harap tunggu...');
            }
            lock = true;
            try {
                return await fn();
            } finally {
                lock = false;
            }
        }

        async function setDailyTarget() {
            await withLock(async () => {
                const targetInput = document.getElementById('targetInput');
                const target = parseInt(targetInput.value);
                
                if (!target || target < 1 || target > 20) {
                    showNotification('Masukkan jumlah target yang valid (1-20)', 'error');
                    return;
                }
                
                const btn = document.getElementById('setTargetBtn');
                btn.innerHTML = '<div class="loading"></div>';
                btn.disabled = true;
                
                try {
                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: `action=setDailyTarget&target=${target}`
                    });
                    
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        showNotification('Target harian berhasil disimpan!', 'success');
                        loadData();
                    } else {
                        showNotification('Gagal menyimpan target: ' + data.message, 'error');
                        btn.disabled = false;
                        btn.innerHTML = '<span>üöÄ Set Target</span>';
                    }
                } catch (error) {
                    console.error('Error setting target:', error);
                    showNotification('Terjadi kesalahan: ' + error.message, 'error');
                    btn.disabled = false;
                    btn.innerHTML = '<span>üöÄ Set Target</span>';
                }
            });
        }

async function startGame(gameId) {
  await withLock(async () => {
    try {
      const response = await fetch(SCRIPT_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `action=startGame&gameId=${encodeURIComponent(gameId)}`
      });

      const data = await response.json();

      if (data.status === 'success') {
        currentGameId = gameId;
        startTime = new Date(data.data.startTime);
        showTimerModal(gameId);
        startTimerDisplay();
      } else {
        showNotification('Gagal memulai game: ' + data.message, 'error');
      }
    } catch (error) {
      console.error('Error starting game:', error);
      showNotification('Terjadi kesalahan: ' + error.message, 'error');

      // Fallback: ambil startTime dari list terbaru jika backend menyimpannya
      await loadGameList();
      const game = gameList.find(g => g.id === gameId);

      showTimerModal(
        gameId,
        game?.startTime ? new Date(game.startTime) : new Date()
      );
    }
  });
}


        function showTimerModal(gameId, forcedStartTime) {
          const game = gameList.find(g => g.id === gameId);
          currentGameId = gameId;
          startTime = forcedStartTime ?? (game?.startTime ? new Date(game.startTime) : new Date());
          document.getElementById('timerModal').style.display = 'flex';
          startTimerDisplay();
        }

        function startTimerDisplay() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            timerInterval = setInterval(updateTimerDisplay, 1000);
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            if (!startTime) return;
            
            const now = new Date();
            const diff = now.getTime() - startTime.getTime();
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('timerDisplay').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function showCompleteModal() {
            if (!currentGameId || !startTime) return;
            
            const now = new Date();
            const diff = now.getTime() - startTime.getTime();
            const minutes = Math.max(1, Math.round(diff / (1000 * 60)));
            
            document.getElementById('timerModal').style.display = 'none';
            document.getElementById('completeModal').style.display = 'flex';
            document.getElementById('completeGameId').value = currentGameId;
            document.getElementById('durationDisplay').textContent = `${minutes} menit`;
            document.getElementById('durationMinutes').value = minutes;
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function closeCompleteModal() {
            document.getElementById('completeModal').style.display = 'none';
            document.getElementById('completeForm').reset();
        }

            document.getElementById('completeForm').addEventListener('submit', async function(e) {
              e.preventDefault();

              await withLock(async () => {
                const gameId = document.getElementById('completeGameId').value;
                const gameName = document.getElementById('gameName').value.trim();
                const gameLink = document.getElementById('gameLink').value.trim();
                const platform = document.getElementById('platform').value;
                const duration = document.getElementById('durationMinutes').value;

                // Validasi
                if (!gameName || gameName.length > 100) {
                  showNotification('Nama game harus diisi (maks 100 karakter)', 'error');
                  return;
                }

                if (!gameLink || !isValidUrl(gameLink)) {
                  showNotification('Link game harus berupa URL yang valid', 'error');
                  return;
                }

                if (!platform) {
                  showNotification('Platform harus dipilih', 'error');
                  return;
                }

                const btn = this.querySelector('button[type="submit"]');
                btn.innerHTML = '<div class="loading"></div>';
                btn.disabled = true;

                try {
                  const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body:
                      `action=completeGame` +
                      `&gameId=${encodeURIComponent(gameId)}` +
                      `&gameName=${encodeURIComponent(gameName)}` +
                      `&gameLink=${encodeURIComponent(gameLink)}` +
                      `&platform=${encodeURIComponent(platform)}` +
                      `&duration=${encodeURIComponent(duration)}`
                  });

                  const data = await response.json();

                  if (data.status === 'success') {
                    // Update summary hanya saat sukses
                    await updateDailySummary();

                    btn.disabled = false;
                    btn.innerHTML = 'Simpan & Selesai';

                    showNotification('Game berhasil diselesaikan!', 'success');
                    closeCompleteModal();
                    loadData();
                    return;
                  }

                  showNotification('Gagal menyelesaikan game: ' + data.message, 'error');
                  btn.disabled = false;
                  btn.innerHTML = 'Simpan & Selesai';
                } catch (error) {
                  console.error('Error completing game:', error);
                  showNotification('Terjadi kesalahan: ' + error.message, 'error');
                  btn.disabled = false;
                  btn.innerHTML = 'Simpan & Selesai';
                }
              });
            });


        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // FIX 2: Correct bonus game calculation
        async function addBonusGame() {
            await withLock(async () => {
                const btn = document.getElementById('addBonusBtn');
                btn.innerHTML = '<div class="loading"></div>';
                btn.disabled = true;
                
                try {
                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: 'action=addBonusGame'
                    });
                    
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        showNotification('Game bonus berhasil ditambahkan!', 'success');
                        loadData();
                    } else {
                        showNotification('Gagal menambahkan game bonus: ' + data.message, 'error');
                        btn.disabled = false;
                        btn.innerHTML = '<span>‚ûï Tambah Game Bonus</span>';
                    }
                } catch (error) {
                    console.error('Error adding bonus game:', error);
                    showNotification('Terjadi kesalahan: ' + error.message, 'error');
                    btn.disabled = false;
                    btn.innerHTML = '<span>‚ûï Tambah Game Bonus</span>';
                }
            });
        }

async function loadPerformanceStats() {
  try {
    const response = await fetch(`${SCRIPT_URL}?action=getPerformanceStats`);
    const data = await response.json();

    if (!(data.status === 'success' && data.data)) return;

    // Update performance stats
    document.getElementById('dailyTotal').textContent = data.data.daily?.total || 0;
    document.getElementById('weeklyTotal').textContent = data.data.weekly?.total || 0;
    document.getElementById('monthlyTotal').textContent = data.data.monthly?.total || 0;
    document.getElementById('avgTime').textContent = data.data.averageTime
      ? Math.round(data.data.averageTime) + 'm'
      : '0m';

    // Update platform breakdown
    const platformList = document.getElementById('platformList');
    if (platformList) {
      platformList.innerHTML = '';

      const platforms = data.data.platforms || {};
      const entries = Object.entries(platforms);

      if (entries.length === 0) {
        platformList.innerHTML = `<div style="color:#94a3b8; padding: 12px 0;">Belum ada data platform.</div>`;
      } else {
        entries.forEach(([platform, count]) => {
          const platformItem = document.createElement('div');
          platformItem.className = 'platform-item';

          const left = document.createElement('div');
          left.className = 'platform-info';

          const icon = document.createElement('div');
          icon.className = 'platform-icon';
          icon.textContent = 'üéÆ';

          const name = document.createElement('span');
          name.className = 'platform-name';
          name.textContent = platform;

          const right = document.createElement('span');
          right.className = 'platform-count';
          right.textContent = String(count);

          left.appendChild(icon);
          left.appendChild(name);
          platformItem.appendChild(left);
          platformItem.appendChild(right);

          platformList.appendChild(platformItem);
        });
      }
    }

    // Achievement summary
    const achievementSummary = document.getElementById('achievementSummary');
    if (achievementSummary) {
      achievementSummary.innerHTML = '';

      // Yesterday
      if (data.data.yesterday) {
        const y = data.data.yesterday;

        const yesterdayDiv = document.createElement('div');
        yesterdayDiv.className = `achievement-item ${y.status || 'warning'}`;

        const lines = [
          `Kemarin: Target ${y.target || 0}`,
          `Selesai ${y.completed || 0}`,
        ];

        if (y.bonus) lines.push(`Bonus ${y.bonus}`);

        yesterdayDiv.innerHTML = `<strong>${lines[0]}</strong><br>${lines.slice(1).join('<br>')}`;
        achievementSummary.appendChild(yesterdayDiv);
      }

      // Today (pakai state currentTarget dan completedGames)
      const todayDiv = document.createElement('div');
      todayDiv.className = `achievement-item ${
        currentTarget > 0 && completedGames >= currentTarget ? 'success' : 'warning'
      }`;

      const todayText =
        currentTarget <= 0
          ? `Hari ini: belum ada target`
          : `Hari ini: Target ${currentTarget}, Selesai ${completedGames}`;

      todayDiv.innerHTML = `<strong>${todayText}</strong>`;
      achievementSummary.appendChild(todayDiv);
    }

    // Isi section "Performa Kemarin"
    const yesterdayPerformance = document.getElementById('yesterdayPerformance');
    if (yesterdayPerformance) {
      yesterdayPerformance.innerHTML = '';

      if (!data.data.yesterday) {
        yesterdayPerformance.innerHTML = `<div style="color:#94a3b8;">Belum ada data kemarin.</div>`;
      } else {
        const y = data.data.yesterday;

        const box = document.createElement('div');
        box.className = `achievement-item ${y.status || 'warning'}`;

        const p1 = document.createElement('div');
        p1.innerHTML = `<strong>Target:</strong> ${y.target || 0}`;

        const p2 = document.createElement('div');
        p2.innerHTML = `<strong>Selesai:</strong> ${y.completed || 0}`;

        const p3 = document.createElement('div');
        p3.innerHTML = `<strong>Bonus:</strong> ${y.bonus || 0}`;

        box.appendChild(p1);
        box.appendChild(p2);
        box.appendChild(p3);

        yesterdayPerformance.appendChild(box);
      }
    }
  } catch (error) {
    console.error('Error loading performance stats:', error);
  }
}


async function loadCharts(period) {
  currentChartPeriod = period;

  // Set active button based on data-period
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.period === period);
  });

  try {
    const response = await fetch(`${SCRIPT_URL}?action=getChartData&period=${period}`);
    const data = await response.json();

    if (data.status === 'success' && data.data) {
      renderCharts(data.data);

      // Optional: pastikan resize benar setelah tab tampil
      setTimeout(() => {
        Object.values(charts).forEach(ch => {
          if (ch) ch.resize();
        });
      }, 0);
    }
  } catch (error) {
    console.error('Error loading charts:', error);
  }
}


        function renderCharts(chartData) {
            // Destroy existing charts
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });
            
            // Platform Pie Chart
            const platformPieCtx = document.getElementById('platformPieChart').getContext('2d');
            charts.pie = new Chart(platformPieCtx, {
                type: 'pie',
                data: {
                    labels: chartData.platforms?.labels || [],
                    datasets: [{
                        data: chartData.platforms?.data || [],
                        backgroundColor: [
                            '#3b82f6', '#10b981', '#f59e0b', '#ef4444', 
                            '#8b5cf6', '#06b6d4', '#64748b'
                        ],
                        borderWidth: 2,
                        borderColor: '#0f172a'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: '#cbd5e1',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        title: {
                            display: false
                        }
                    }
                }
            });
            
            // Completion Line Chart
            const completionLineCtx = document.getElementById('completionLineChart').getContext('2d');
            charts.line = new Chart(completionLineCtx, {
                type: 'line',
                data: {
                    labels: chartData.trend?.labels || [],
                    datasets: [{
                        label: 'Game Selesai',
                        data: chartData.trend?.data || [],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#cbd5e1'
                            }
                        }
                    }
                }
            });
            
            // Platform Bar Chart
            const platformBarCtx = document.getElementById('platformBarChart').getContext('2d');
            charts.bar = new Chart(platformBarCtx, {
                type: 'bar',
                data: {
                    labels: chartData.comparison?.labels || [],
                    datasets: [{
                        label: 'Jumlah Game',
                        data: chartData.comparison?.data || [],
                        backgroundColor: '#3b82f6',
                        borderColor: '#1d4ed8',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#cbd5e1'
                            }
                        }
                    }
                }
            });
            
            // Time Chart
            const timeCtx = document.getElementById('timeChart').getContext('2d');
            charts.time = new Chart(timeCtx, {
                type: 'radar',
                data: {
                    labels: chartData.time?.labels || [],
                    datasets: [{
                        label: 'Waktu (menit)',
                        data: chartData.time?.data || [],
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: '#3b82f6',
                        borderWidth: 2,
                        pointBackgroundColor: '#3b82f6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            pointLabels: {
                                color: '#cbd5e1'
                            },
                            ticks: {
                                color: '#94a3b8',
                                backdropColor: 'transparent'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#cbd5e1'
                            }
                        }
                    }
                }
            });
        }

function switchTab(tabName, buttonEl) {
  // Hide all tabs
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });

  // Deactivate all tab buttons
  document.querySelectorAll('.tab').forEach(btn => {
    btn.classList.remove('active');
  });

  // Show selected tab
  document.getElementById(tabName + 'Tab').classList.add('active');

  // Activate selected button
  if (buttonEl) buttonEl.classList.add('active');

  // Load data for the tab
  if (tabName === 'charts') {
    requestAnimationFrame(() => loadCharts(currentChartPeriod));
  } else if (tabName === 'performance') {
    loadPerformanceStats();
  }
}


        // FIX 1: Update daily summary function dengan parameter tanggal
        async function updateDailySummaryForDate(dateObj) {
            try {
                const dateStr = dateObj.toISOString().split('T')[0];
                const response = await fetch(`${SCRIPT_URL}?action=updateDailySummary&date=${dateStr}`);
                const data = await response.json();
                if (data.status === 'error') {
                    console.warn('Failed to update daily summary for date:', dateStr, data.message);
                }
                return data;
            } catch (error) {
                console.error('Error updating daily summary:', error);
                return { status: 'error', message: error.message };
            }
        }

        // Fungsi asli untuk kompatibilitas
        async function updateDailySummary() {
            return updateDailySummaryForDate(new Date());
        }

        // Add CSS animation for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
